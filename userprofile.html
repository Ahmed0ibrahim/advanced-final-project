<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <title>Document</title>
</head>
<style>
    body {
      background-color: #d7d0f0;
    }

    .lds-roller {
  /* change color here */
  color: #ffffff
}
  
.lds-roller,
.lds-roller div,
.lds-roller div:after {
  box-sizing: border-box;
}
.lds-roller {
  display: inline-block;
  position: relative;
  width: 80px;
  height: 80px;
}
.lds-roller div {
  animation: lds-roller 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite;
  transform-origin: 40px 40px;
}
.lds-roller div:after {
  content: " ";
  display: block;
  position: absolute;
  width: 7.2px;
  height: 7.2px;
  border-radius: 50%;
  background: currentColor;
  margin: -3.6px 0 0 -3.6px;
}
.lds-roller div:nth-child(1) {
  animation-delay: -0.036s;
}
.lds-roller div:nth-child(1):after {
  top: 62.62742px;
  left: 62.62742px;
}
.lds-roller div:nth-child(2) {
  animation-delay: -0.072s;
}
.lds-roller div:nth-child(2):after {
  top: 67.71281px;
  left: 56px;
}
.lds-roller div:nth-child(3) {
  animation-delay: -0.108s;
}
.lds-roller div:nth-child(3):after {
  top: 70.90963px;
  left: 48.28221px;
}
.lds-roller div:nth-child(4) {
  animation-delay: -0.144s;
}
.lds-roller div:nth-child(4):after {
  top: 72px;
  left: 40px;
}
.lds-roller div:nth-child(5) {
  animation-delay: -0.18s;
}
.lds-roller div:nth-child(5):after {
  top: 70.90963px;
  left: 31.71779px;
}
.lds-roller div:nth-child(6) {
  animation-delay: -0.216s;
}
.lds-roller div:nth-child(6):after {
  top: 67.71281px;
  left: 24px;
}
.lds-roller div:nth-child(7) {
  animation-delay: -0.252s;
}
.lds-roller div:nth-child(7):after {
  top: 62.62742px;
  left: 17.37258px;
}
.lds-roller div:nth-child(8) {
  animation-delay: -0.288s;
}
.lds-roller div:nth-child(8):after {
  top: 56px;
  left: 12.28719px;
}
@keyframes lds-roller {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

  </style>
<body>

  <div  id="loader" style="position: fixed; right: 50%; top: 50%; margin: auto; background-color: rgba(189, 185, 185 , 0.3); z-index: 9999; border-radius: 20px; display: block; ">
    <div class="lds-roller"><div></div><div></div><div></div><div></div><div></div><div></div><div></div><div></div></div>
  </div>
  <div  class="bg-primary d-flex justify-content-center align-items-center" onclick="createpost()" style="position:absolute; z-index: 9999; color:white; padding: 5px; width: 50px; height: 50px; border-radius: 50%; font-size: 30px; align-self: center; position: fixed; bottom: 5%; right:7%; box-shadow: 0px 10px 10px rgba(0,0,0 , 0.3); cursor: pointer; visibility: hidden;" id="newpost"> + </div>



    <!-- nav bar cont -->
  <div class="container">
    <div class="d-flex justify-content-center">
      <div class="col-8 bg-light shadow-sm  mb-2  rounded">
        <nav class="navbar navbar-expand-lg" style="border-radius: 0 0 5px 5px;">
          <div class="container-fluid " style="position: relative;">
            <a class="navbar-brand" href="">Tarmeez</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
              aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
              <ul class="navbar-nav">
                <li class="nav-item">
                  <a class="nav-link active" aria-current="page" href="home.html">Home</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="profile.html">Profile</a>
                </li>
              </ul>
              <div id="logindiv" style="display: flex; direction:rtl ; width:100% ;">
                <a href="register.html"><button id="registerbtn" class="btn btn-outline-success mx-2">Register</button></a>
                <a href="login.html"><button type="button" id="loginbtn" class="btn btn-outline-success mx-2" >login</button></a>
                <div class="loggedin" style="display: flex; flex-direction: row; position: absolute; justify-content: space-between;">
                  <button type="button" id="logoutbtn" class="btn btn-outline-danger" style="display: none;" onclick="logout()">Logout</button>
                  <span id="showusername" class="mx-2" style="align-self: center;"></span>
                  <img id="showprofimg" style="width: 40px; height: 40px; display: none;" class="rounded-circle" src="">
                </div>
              </div>
            </div>
          </div>
        </nav>
      </div>
    </div>
  </div>
  <!-- end nav bar cont -->

  <!-- start profile ui -->
   <div class="container-sm bg-light col-8" style="height:200px; margin-top:50px; border-radius: 10px; display: flex;">
        <div class="d-flex" style="flex-direction: row; justify-content: space-between;  width: 100%;" >
            <div style="display: flex; flex-direction: row; align-self: center; margin-left: 50px;">
                <div>        
                    <img id="profileimage" src="" style="width: 90px; height: 90px; align-self: center;" class="rounded-circle">
                </div>
                <div style="align-self: center; margin-left: 50px;">
                    <h5 style="margin-bottom: 50px;" id="username">username</h5>
                    <h5 id="name">name</h5>
                </div>
            </div>

            <div  class="" style="  min-height: fit-content; display: flex; flex-direction: column; align-items: start; justify-content: center; margin-right: 200px;">
                <div style="display: flex; align-items: center;">
                    <div id="postscount" class="rounded-circle  d-flex" style=" margin: 20px;  align-items: center; justify-content: center; width: 30px; height: 30px; border:2px solid black;" ></div>
                    <div><h4>posts</h4></div>
                </div>
                <div style="display: flex; align-items: center;">
                    <div id="commentscount" class="rounded-circle  d-flex" style=" margin: 20px; align-items: center; justify-content: center; width: 30px; height: 30px; border:2px solid black;" ></div>
                    <div><h4>comment</h4></div>
                </div>
            </div>
        </div>
   </div>

   <div class="container-sm  col-8" style="margin: 40px 200px;">
    <h2 id="usernameposts"></h2>
   </div>
  <!-- end profile ui -->

  <!-- start posts body -->
   
    <div id="posts" class="posts d-flex flex-column justify-content-start align-items-center ">
      
    </div>
  <!-- end posts body -->
</body>

<script>
    

function uisetup() {
  const token = localStorage.getItem("token")


  const loginbtn = document.getElementById('loginbtn')
  const registerbtn = document.getElementById('registerbtn')
  const logoutbtn = document.getElementById('logoutbtn')
  const showusername = document.getElementById('showusername')
  const showprofimg = document.getElementById('showprofimg')
  const newpost = document.getElementById('newpost')
  if (token == null) {

  } else {
    const Userid = localStorage.getItem("Userid")
    loginbtn.style.visibility = "hidden"
    registerbtn.style.visibility = "hidden"
    logoutbtn.style.display = "flex"

    let user = localStorage.getItem("user")
    const User = JSON.parse(user)


    showusername.innerHTML = `${User.username}`
    if (User.profile_image != null) {
      showprofimg.style.display = "flex"
      showprofimg.src = `${User.profile_image}`

    } else { }

    newpost.style.visibility = "visible"


  }
}uisetup()




let userstring = localStorage.getItem("user");
var userjson = JSON.parse(userstring);
var userid = userjson.id;

const Urlparams = new URLSearchParams(window.location.search)
    const authorid = Urlparams.get("authorId")
    console.log(authorid)
    axios.get("https://tarmeezacademy.com/api/v1/posts")
.then((response => {
  console.log("All posts data:", response.data.data);
  let posts = response.data.data;
  let parent = ``;
  let i = 1

  for (let post of posts) {
    console.log("Post author ID:", post.author.id)
    console.log("author id" , authorid)


    if (authorid == post.author.id) { // Check if the post's author ID matches the logged-in user's ID
      
    
    let usernameposts = document.getElementById('usernameposts')
    usernameposts.innerHTML = `${post.author.username} posts`


    function containersetup(){
        
    document.getElementById('profileimage').src = post.author.profile_image
    document.getElementById('username').innerHTML = post.author.username
    document.getElementById('name').innerHTML = post.author.name
    const postscount =  document.getElementById('postscount') 
    postscount.innerHTML = i
    i = i+1
    document.getElementById('commentscount').innerHTML = post.comments_count

    
}containersetup()







      let postsContainer = document.getElementById('posts');
      if(post.author.id == userid){
        parent = `<button id="edit-post-btn" style="margin-left:10px; visibility:visible;" class="btn btn-secondary" onclick="editpost(${post.id})">Edit</button>
          <button id="delete-post-btn" style="margin-left:10px; visibility:visible;" class="btn btn-danger" onclick="deletepost(${post.id})">Delete</button>`;

}else{

      }
    
      postsContainer.innerHTML +=
        `<div class="col-12 d-flex flex-column justify-content-start align-items-center" style="position:relative;">
          <div id="parent" style="position:absolute; z-index:99999; display:flex; right:20%; top:10px;">
            ${parent}
          </div>
          <div style="color:black; cursor:pointer;" class="col-8" onclick="postclicked(${post.id})">
            <div id="post" class="post rounded col-12 bg-light shadow mb-5" style="min-height: 350px; overflow: hidden;">
              <!-- start title -->
              <div class="title rounded-top d-flex align-items-center p-2" style="background-color: rgb(226, 222, 235);">
                <img id="prof-img" src="${post.author.profile_image}" alt="" class="rounded-circle m-2" style="width: 30px; height: 30px;">
                <h5 id="name" style="font-size: 15px;">${post.author.name}</h5>
              </div>
              <!-- end title -->
              <!-- start img -->
              <div class="img p-3 pb-0" style="height: 350px">
                <img id="post-img" src="${post.image}" class="rounded" style="width:100%; height: 100%;">
              </div>
              <!-- end img -->
              <!-- start caption -->
              <div class="ps-3 caption">
                <p id="created_at" style="margin-top: 0; margin-bottom: 0; color: rgb(150, 150, 150);">${post.created_at}</p>
                <p id="title" style="font-weight: 600; margin-bottom: 0;">"${post.title}"</p>
                <p id="caption-body" style="margin-bottom: 0;">${post.body}</p>
              </div>
              <!-- end caption -->
              <hr class="m-3">
              <!-- start comment -->
              <div class="comment d-flex ps-3 mb-3">
                <i class="bi bi-pen" style="margin-right: 2px; font-size:medium;"></i>
                <span id="comment-count">(${post.comments_count}) comments</span>
                <span style="background-color: #acabb1; border-radius:20px; padding:3px 5px; color:white; margin-left:5px; font-size:small;">${post.id}</span>
              </div>
              <!-- end comment -->
            </div>
          </div>
        </div>`;
    }
  
    else{
      console.log("false")
    }
  
  }
 
   const loader = document.getElementById('loader')
    loader.style.display = "none"
}))


let editpostbtn = document.getElementById('edit-post-btn');

function editpost(postId) {
  window.location.href = `editpost.html?postId=${postId}`;
}

function deletepost(postid) {
  const token = localStorage.getItem("token");
  const headers = {
    "authorization": `Bearer ${token}`
  };
  axios.delete(`https://tarmeezacademy.com/api/v1/posts/${postid}`, {
    headers: headers
  })
  .then((response) => {
    location.reload();
    console.log(postid);

    if (true) {
      alert("The post has been deleted successfully");
    }
  });
}





function postclicked(postId) {

window.location.href = `postdetails.html?postId=${postId}`
}

function logout() {
  localStorage.removeItem("token")
  localStorage.removeItem("user")
  location.href = 'home.html'
}



function createpost() {
  location.href = "newpost.html"
}




</script>
</html>